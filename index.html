<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üßô Wizard Chess</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #0b1020;
    color: #eaf1ff;
    text-align: center;
    padding: 20px;
  }

  button {
    padding: 12px 20px;
    font-size: 16px;
    margin: 10px;
    cursor: pointer;
  }

  #status {
    margin-top: 15px;
    font-size: 18px;
  }

  .glow {
    animation: glow 1.2s infinite alternate;
  }

  @keyframes glow {
    from { text-shadow: 0 0 6px #7cf; }
    to   { text-shadow: 0 0 22px #39f; }
  }

  #log {
    margin-top: 20px;
    background: #11162c;
    padding: 10px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    text-align: left;
    font-family: monospace;
    height: 180px;
    overflow-y: auto;
  }

  #moveBanner {
    display: none;
    font-size: 28px;
    color: #7cf;
    margin-top: 20px;
  }
</style>
</head>

<body>

<h1>üßô Wizard Chess</h1>
<p>Voice-controlled magnetic chessboard (with simulation fallback)</p>

<button onclick="startSystem()">üé§ Start Wizard</button>

<div id="status">Status: Idle</div>

<h2 id="moveBanner">‚ôü MOVE: <span id="fromSq"></span> ‚Üí <span id="toSq"></span></h2>

<div id="log"></div>

<audio id="magicSound">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg">
</audio>

<script>
/* -------------------- UI HELPERS -------------------- */

const statusEl = document.getElementById("status");
const logEl = document.getElementById("log");

function setStatus(text, glow = false) {
  statusEl.textContent = "Status: " + text;
  statusEl.classList.toggle("glow", glow);
}

function log(msg) {
  logEl.innerHTML += msg + "<br>";
  logEl.scrollTop = logEl.scrollHeight;
}

/* -------------------- MOVE DISPLAY -------------------- */

function showMove(from, to) {
  document.getElementById("fromSq").textContent = from;
  document.getElementById("toSq").textContent = to;
  const banner = document.getElementById("moveBanner");
  banner.style.display = "block";
  document.getElementById("magicSound").play();
  setTimeout(() => banner.style.display = "none", 2200);
}

/* -------------------- FUZZY MOVE PARSER -------------------- */

function extractMove(text) {
  text = text.toUpperCase().replace(/[^A-Z0-9 ]/g, " ");
  const matches = text.match(/[A-H][1-8]/g);
  if (matches && matches.length >= 2) {
    return { from: matches[0], to: matches[1] };
  }
  return null;
}

/* -------------------- ARDUINO CHECK -------------------- */

function isArduinoConnected() {
  // Web Serial API check (Chrome / Edge only)
  return "serial" in navigator;
}

/* -------------------- SIMULATION -------------------- */

function simulateMove(from, to) {
  log("üß™ Simulation mode active");
  log(`üß≤ Virtual magnet moving from ${from} to ${to}`);
  setTimeout(() => {
    log("‚úÖ Simulation complete");
    setStatus("Idle");
  }, 1500);
}

/* -------------------- VOICE SYSTEM -------------------- */

function startSystem() {
  log("üßô Wizard initialized");

  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech Recognition not supported in this browser");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "en-US";
  recognition.interimResults = false;

  recognition.onstart = () => {
    setStatus("Listening‚Ä¶", true);
    log("üé§ Listening for move...");
  };

  recognition.onresult = (event) => {
    const speech = event.results[0][0].transcript;
    log("üó£ Heard: " + speech);

    const move = extractMove(speech);
    if (!move) {
      log("‚ùå Could not understand move");
      setStatus("Idle");
      return;
    }

    showMove(move.from, move.to);
    log("‚ú® Best move inferred");

    if (isArduinoConnected()) {
      log("üîå Arduino detected");
      log("üß≤ (Arduino control would execute here)");
      setTimeout(() => {
        log("‚úÖ Move executed via Arduino");
        setStatus("Idle");
      }, 1500);
    } else {
      log("‚ö† Arduino not detected");
      if (confirm("Arduino not connected. Start simulation mode?")) {
        simulateMove(move.from, move.to);
      } else {
        setStatus("Idle");
      }
    }
  };

  recognition.onerror = () => {
    log("‚ùå Voice recognition error");
    setStatus("Idle");
  };

  recognition.start();
}
</script>

</body>
</html>
